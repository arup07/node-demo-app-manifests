# Architecture Guide: PVC & ArgoCD Sync

Essential diagrams explaining Persistent Volume Claims (PVC) and ArgoCD sync workflow.

---

## ğŸ“¦ Table of Contents

1. [Persistent Volume Claim (PVC) Workflow](#persistent-volume-claim-pvc-workflow)
2. [ArgoCD Sync Cycle](#argocd-sync-cycle)

---

## Persistent Volume Claim (PVC) Workflow

### How PVC Works - Complete Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Developer Defines PVC in YAML                      â”‚
â”‚                                                             â”‚
â”‚  apiVersion: v1                                             â”‚
â”‚  kind: PersistentVolumeClaim                                â”‚
â”‚  metadata:                                                  â”‚
â”‚    name: postgres-pvc                                       â”‚
â”‚  spec:                                                      â”‚
â”‚    accessModes:                                             â”‚
â”‚      - ReadWriteOnce  # Only ONE pod can mount             â”‚
â”‚    resources:                                               â”‚
â”‚      requests:                                              â”‚
â”‚        storage: 1Gi   # Request 1GB of storage             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ kubectl apply -f postgres-deployment.yaml
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Kubernetes Creates PVC                             â”‚
â”‚                                                             â”‚
â”‚  $ kubectl get pvc                                          â”‚
â”‚  NAME           STATUS    VOLUME   CAPACITY   ACCESS MODES  â”‚
â”‚  postgres-pvc   Pending   -        -          -             â”‚
â”‚                                                             â”‚
â”‚  Status: Pending (waiting for storage to be provisioned)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Storage Class Provisioner Creates PV               â”‚
â”‚                                                             â”‚
â”‚  In Minikube:                                               â”‚
â”‚  - storageClassName: standard (default)                     â”‚
â”‚  - provisioner: k8s.io/minikube-hostpath                    â”‚
â”‚                                                             â”‚
â”‚  Automatically creates a Persistent Volume (PV):            â”‚
â”‚  - Creates directory on host machine                        â”‚
â”‚  - Allocates 1Gi of space                                   â”‚
â”‚  - Sets up volume with ReadWriteOnce access                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: PV is Bound to PVC                                 â”‚
â”‚                                                             â”‚
â”‚  $ kubectl get pvc                                          â”‚
â”‚  NAME           STATUS   VOLUME                  CAPACITY   â”‚
â”‚  postgres-pvc   Bound    pvc-abc123...           1Gi        â”‚
â”‚                                                             â”‚
â”‚  $ kubectl get pv                                           â”‚
â”‚  NAME              CAPACITY   ACCESS    STATUS    CLAIM     â”‚
â”‚  pvc-abc123...     1Gi        RWO       Bound     default/  â”‚
â”‚                                                   postgres- â”‚
â”‚                                                   pvc        â”‚
â”‚                                                             â”‚
â”‚  Physical Location (Minikube):                              â”‚
â”‚  /tmp/hostpath-provisioner/default-postgres-pvc-abc123/     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: PostgreSQL Pod Mounts the PVC                      â”‚
â”‚                                                             â”‚
â”‚  In postgres-deployment.yaml:                               â”‚
â”‚                                                             â”‚
â”‚  spec:                                                      â”‚
â”‚    containers:                                              â”‚
â”‚    - name: postgres                                         â”‚
â”‚      volumeMounts:                                          â”‚
â”‚      - name: postgres-storage                               â”‚
â”‚        mountPath: /var/lib/postgresql/data  â† Mount here   â”‚
â”‚    volumes:                                                 â”‚
â”‚    - name: postgres-storage                                 â”‚
â”‚      persistentVolumeClaim:                                 â”‚
â”‚        claimName: postgres-pvc  â† Reference PVC             â”‚
â”‚                                                             â”‚
â”‚  When pod starts, PVC is mounted inside the container       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: Data Flows Between Container and PVC               â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  PostgreSQL Container                â”‚                  â”‚
â”‚  â”‚                                      â”‚                  â”‚
â”‚  â”‚  Application writes data to:         â”‚                  â”‚
â”‚  â”‚  /var/lib/postgresql/data/           â”‚                  â”‚
â”‚  â”‚    â”œâ”€â”€ base/         (tables)        â”‚                  â”‚
â”‚  â”‚    â”œâ”€â”€ global/       (catalogs)      â”‚                  â”‚
â”‚  â”‚    â”œâ”€â”€ pg_wal/       (logs)          â”‚                  â”‚
â”‚  â”‚    â””â”€â”€ pg_stat/      (stats)         â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                 â”‚                                           â”‚
â”‚                 â”‚ Data automatically persisted              â”‚
â”‚                 â†“                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  PVC: postgres-pvc                   â”‚                  â”‚
â”‚  â”‚  Mounted at: /var/lib/postgresql/dataâ”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                 â”‚                                           â”‚
â”‚                 â”‚ Maps to                                   â”‚
â”‚                 â†“                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  PV: Physical Storage                â”‚                  â”‚
â”‚  â”‚  /tmp/hostpath-provisioner/...       â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Data Persistence Scenario: Pod Restart

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCENARIO: What happens when PostgreSQL pod is deleted?     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T=0s: Normal Operation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pod: postgres-885995bd9-hfdm5                 Running   â”‚
â”‚  PVC: postgres-pvc                             Bound     â”‚
â”‚  Data: 150MB of database files on disk                   â”‚
â”‚                                                          â”‚
â”‚  /var/lib/postgresql/data/                               â”‚
â”‚    â”œâ”€â”€ base/          (database files)                   â”‚
â”‚    â”œâ”€â”€ pg_wal/        (transaction logs)                 â”‚
â”‚    â””â”€â”€ postgresql.conf                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ kubectl delete pod postgres-xxxxx
                       â†“
T=1s: Pod Terminating
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pod: postgres-885995bd9-hfdm5          Terminating      â”‚
â”‚  - PostgreSQL gracefully shuts down                      â”‚
â”‚  - Flushes all pending writes to disk                    â”‚
â”‚  - Closes database connections                           â”‚
â”‚                                                          â”‚
â”‚  PVC: postgres-pvc                      Still Bound âœ…   â”‚
â”‚  Data: 150MB still on disk                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
T=3s: Pod Deleted, New Pod Creating
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Old Pod: DELETED âŒ                                      â”‚
â”‚                                                          â”‚
â”‚  New Pod: postgres-885995bd9-xyz123     ContainerCreatingâ”‚
â”‚  - Kubernetes Deployment creates replacement             â”‚
â”‚  - Same PVC reference in spec                            â”‚
â”‚                                                          â”‚
â”‚  PVC: postgres-pvc                      Still Bound âœ…   â”‚
â”‚  Data: 150MB waiting to be remounted                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
T=5s: New Pod Mounting PVC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  New Pod: postgres-885995bd9-xyz123     Running          â”‚
â”‚  - Container started                                     â”‚
â”‚  - PVC mounted to /var/lib/postgresql/data               â”‚
â”‚  - PostgreSQL finds EXISTING data files âœ…               â”‚
â”‚                                                          â”‚
â”‚  PVC: postgres-pvc                      Bound to new pod â”‚
â”‚  Data: Same 150MB, no data loss!                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
T=10s: Database Recovered
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL Recovery Process:                            â”‚
â”‚  1. Reads existing database files                        â”‚
â”‚  2. Applies Write-Ahead Log (WAL) if needed              â”‚
â”‚  3. Validates data integrity                             â”‚
â”‚  4. Database fully operational                           â”‚
â”‚                                                          â”‚
â”‚  Result: ZERO DATA LOSS! ğŸ‰                              â”‚
â”‚  - All tables intact                                     â”‚
â”‚  - All data preserved                                    â”‚
â”‚  - Ready to accept connections                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### PVC Lifecycle Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PVC States                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Pending  â†’ Waiting for storage provisioning            â”‚
â”‚             (StorageClass creates PV)                    â”‚
â”‚      â†“                                                   â”‚
â”‚  Bound    â†’ PVC successfully attached to PV              â”‚
â”‚             (Pod can now mount it)                       â”‚
â”‚      â†“                                                   â”‚
â”‚  InUse    â†’ Pod is actively using the PVC                â”‚
â”‚             (Data being read/written)                    â”‚
â”‚      â†“                                                   â”‚
â”‚  Released â†’ Pod deleted, but data still exists           â”‚
â”‚             (PV not yet reclaimed)                       â”‚
â”‚      â†“                                                   â”‚
â”‚  Deleted  â†’ PVC deleted (reclaim policy determines       â”‚
â”‚             if data is deleted or retained)              â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Access Modes (Important!)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ReadWriteOnce (RWO) â† We use this for PostgreSQL       â”‚
â”‚  âœ“ One pod can read/write at a time                     â”‚
â”‚  âœ— Other pods cannot mount simultaneously                â”‚
â”‚  Use case: Databases (prevents data corruption)          â”‚
â”‚                                                          â”‚
â”‚  ReadWriteMany (RWX)                                     â”‚
â”‚  âœ“ Multiple pods can read/write simultaneously           â”‚
â”‚  Use case: Shared file systems (NFS)                     â”‚
â”‚                                                          â”‚
â”‚  ReadOnlyMany (ROX)                                      â”‚
â”‚  âœ“ Multiple pods can read (no writes)                    â”‚
â”‚  Use case: Configuration files, static content           â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ArgoCD Sync Cycle

### Complete Sync Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SOURCE OF TRUTH: Git Repository                            â”‚
â”‚  https://github.com/arup07/node-demo-app-manifests          â”‚
â”‚                                                              â”‚
â”‚  â”œâ”€â”€ deployment.yaml          (Desired State)               â”‚
â”‚  â”œâ”€â”€ service.yaml                                           â”‚
â”‚  â”œâ”€â”€ configmap.yaml                                         â”‚
â”‚  â”œâ”€â”€ secret.yaml                                            â”‚
â”‚  â”œâ”€â”€ postgres-deployment.yaml                               â”‚
â”‚  â””â”€â”€ argocd-app.yaml                                        â”‚
â”‚                                                              â”‚
â”‚  Example: deployment.yaml                                   â”‚
â”‚  spec:                                                      â”‚
â”‚    replicas: 2                   â† Desired state            â”‚
â”‚    image: arup07/node-demo-app:7                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ ArgoCD polls Git every 3 minutes
                   â”‚ (configurable interval)
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: ArgoCD Fetches Latest from Git                     â”‚
â”‚                                                              â”‚
â”‚  ArgoCD Application Controller:                             â”‚
â”‚  - Clones/pulls Git repository                              â”‚
â”‚  - Reads all YAML manifests                                 â”‚
â”‚  - Parses Kubernetes resources                              â”‚
â”‚  - Builds desired state model                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Query Current Cluster State                        â”‚
â”‚                                                              â”‚
â”‚  kubectl get deployment node-demo-app -o yaml               â”‚
â”‚  kubectl get service node-demo-app-service -o yaml          â”‚
â”‚  kubectl get configmap node-demo-app-config -o yaml         â”‚
â”‚  ... (all resources)                                        â”‚
â”‚                                                              â”‚
â”‚  Example current state:                                     â”‚
â”‚  spec:                                                      â”‚
â”‚    replicas: 2                   â† Current state            â”‚
â”‚    image: arup07/node-demo-app:6  (older image!)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Compare Desired (Git) vs Actual (Cluster)          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Git (Desired)        â”‚    â”‚ Cluster (Actual)     â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ replicas: 2          â”‚ =  â”‚ replicas: 2          â”‚ âœ“    â”‚
â”‚  â”‚ image: ...:7         â”‚ â‰   â”‚ image: ...:6         â”‚ âœ—    â”‚
â”‚  â”‚ configmap: exists    â”‚ =  â”‚ configmap: exists    â”‚ âœ“    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  Result: OUT OF SYNC (image version differs)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Sync Decision                                      â”‚
â”‚                                                              â”‚
â”‚  Check sync policy in argocd-app.yaml:                      â”‚
â”‚                                                              â”‚
â”‚  syncPolicy:                                                â”‚
â”‚    automated:                                               â”‚
â”‚      prune: true        # Delete resources not in Git       â”‚
â”‚      selfHeal: true     # Auto-fix manual changes           â”‚
â”‚                                                              â”‚
â”‚  Decision: Auto-sync is ENABLED â†’ Proceed with sync        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: Apply Changes to Cluster                           â”‚
â”‚                                                              â”‚
â”‚  ArgoCD executes:                                           â”‚
â”‚  kubectl apply -f deployment.yaml                           â”‚
â”‚                                                              â”‚
â”‚  Kubernetes performs rolling update:                        â”‚
â”‚  1. Create new pod with image :7                            â”‚
â”‚  2. Wait for new pod to be Ready                            â”‚
â”‚  3. Terminate old pod with image :6                         â”‚
â”‚  4. Create another new pod with image :7                    â”‚
â”‚  5. Terminate last old pod                                  â”‚
â”‚                                                              â”‚
â”‚  Result: Gradual update, zero downtime                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: Verify Sync Success                                â”‚
â”‚                                                              â”‚
â”‚  $ kubectl get applications -n argocd                       â”‚
â”‚  NAME            SYNC STATUS   HEALTH STATUS                â”‚
â”‚  node-demo-app   Synced        Healthy          âœ…          â”‚
â”‚                                                              â”‚
â”‚  Cluster state now matches Git state                        â”‚
â”‚  - All pods running with image :7                           â”‚
â”‚  - All resources in sync                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Self-Heal Feature

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCENARIO: Manual Change to Cluster (Drift Detection)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T=0s: System in Sync
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Git:     replicas: 2                                    â”‚
â”‚  Cluster: replicas: 2                    Status: Synced  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Someone runs manual command:
                       â”‚ kubectl scale deployment node-demo-app --replicas=5
                       â†“
T=1s: Manual Change Applied
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Git:     replicas: 2    (unchanged)                     â”‚
â”‚  Cluster: replicas: 5    (manually changed)              â”‚
â”‚                                                          â”‚
â”‚  State: DRIFT DETECTED âš ï¸                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ ArgoCD detects drift within seconds
                       â†“
T=5s: Self-Heal Triggers
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ArgoCD Application Controller:                          â”‚
â”‚  - Detects cluster state â‰  Git state                     â”‚
â”‚  - selfHeal: true (enabled)                              â”‚
â”‚  - Initiates automatic sync                              â”‚
â”‚                                                          â”‚
â”‚  Action: Revert cluster to match Git                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ kubectl apply -f deployment.yaml (replicas: 2)
                       â†“
T=10s: Cluster Healed
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Git:     replicas: 2                                    â”‚
â”‚  Cluster: replicas: 2    (reverted back)                 â”‚
â”‚                                                          â”‚
â”‚  State: Synced âœ…                                         â”‚
â”‚                                                          â”‚
â”‚  Result: Git is ALWAYS the source of truth!              â”‚
â”‚  Manual changes are automatically reverted               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Auto-Prune Feature

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCENARIO: Resource Deleted from Git                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T=0s: ConfigMap Exists
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Git Repo:                                               â”‚
â”‚  â”œâ”€â”€ deployment.yaml                                     â”‚
â”‚  â”œâ”€â”€ service.yaml                                        â”‚
â”‚  â””â”€â”€ configmap.yaml         â† Exists in Git              â”‚
â”‚                                                          â”‚
â”‚  Cluster:                                                â”‚
â”‚  â”œâ”€â”€ Deployment: node-demo-app                           â”‚
â”‚  â”œâ”€â”€ Service: node-demo-app-service                      â”‚
â”‚  â””â”€â”€ ConfigMap: node-demo-app-config  â† Exists in clusterâ”‚
â”‚                                                          â”‚
â”‚  Status: Synced âœ…                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Developer deletes configmap.yaml from Git
                       â”‚ git rm configmap.yaml
                       â”‚ git commit -m "Remove unused configmap"
                       â”‚ git push origin main
                       â†“
T=1s: Git Updated
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Git Repo:                                               â”‚
â”‚  â”œâ”€â”€ deployment.yaml                                     â”‚
â”‚  â””â”€â”€ service.yaml                                        â”‚
â”‚  (configmap.yaml deleted)    â† No longer in Git          â”‚
â”‚                                                          â”‚
â”‚  Cluster:                                                â”‚
â”‚  â”œâ”€â”€ Deployment: node-demo-app                           â”‚
â”‚  â”œâ”€â”€ Service: node-demo-app-service                      â”‚
â”‚  â””â”€â”€ ConfigMap: node-demo-app-config  â† Still in cluster â”‚
â”‚                                                          â”‚
â”‚  Status: Out of Sync âš ï¸                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ ArgoCD detects (within 3 minutes or on refresh)
                       â†“
T=3min: Auto-Prune Triggers
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ArgoCD Analysis:                                        â”‚
â”‚  - ConfigMap exists in cluster                           â”‚
â”‚  - ConfigMap NOT in Git                                  â”‚
â”‚  - prune: true (enabled in sync policy)                  â”‚
â”‚                                                          â”‚
â”‚  Decision: Delete ConfigMap from cluster                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ kubectl delete configmap node-demo-app-config
                       â†“
T=3min 5s: Resource Pruned
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Git Repo:                                               â”‚
â”‚  â”œâ”€â”€ deployment.yaml                                     â”‚
â”‚  â””â”€â”€ service.yaml                                        â”‚
â”‚                                                          â”‚
â”‚  Cluster:                                                â”‚
â”‚  â”œâ”€â”€ Deployment: node-demo-app                           â”‚
â”‚  â””â”€â”€ Service: node-demo-app-service                      â”‚
â”‚  (ConfigMap deleted)         â† Removed from cluster      â”‚
â”‚                                                          â”‚
â”‚  Status: Synced âœ…                                        â”‚
â”‚                                                          â”‚
â”‚  Result: Cluster matches Git perfectly                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Sync Policy Configuration

```yaml
# In argocd-app.yaml

syncPolicy:
  automated:
    prune: true        # Enable auto-prune
    selfHeal: true     # Enable self-heal
    allowEmpty: false  # Don't sync if repo is empty
  
  syncOptions:
    - CreateNamespace=true  # Auto-create namespace if needed
    - PruneLast=true        # Prune resources last (safer)
  
  retry:
    limit: 5            # Retry up to 5 times on failure
    backoff:
      duration: 5s      # Initial retry after 5 seconds
      factor: 2         # Double wait time on each retry
      maxDuration: 3m   # Maximum 3 minutes between retries
```

### Sync States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ArgoCD Application States                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Synced                                                      â”‚
â”‚  âœ… Cluster matches Git                                      â”‚
â”‚  âœ… All resources deployed correctly                         â”‚
â”‚  âœ… No action needed                                         â”‚
â”‚                                                              â”‚
â”‚  OutOfSync                                                   â”‚
â”‚  âš ï¸  Git â‰  Cluster                                           â”‚
â”‚  âš ï¸  Changes detected                                        â”‚
â”‚  âš ï¸  Sync needed                                             â”‚
â”‚                                                              â”‚
â”‚  Syncing                                                     â”‚
â”‚  ğŸ”„ Sync in progress                                         â”‚
â”‚  ğŸ”„ Applying changes                                         â”‚
â”‚  ğŸ”„ Wait for completion                                      â”‚
â”‚                                                              â”‚
â”‚  Unknown                                                     â”‚
â”‚  â“ Cannot determine state                                   â”‚
â”‚  â“ Check connectivity                                       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Health States                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Healthy                                                     â”‚
â”‚  âœ… All pods running                                         â”‚
â”‚  âœ… All services accessible                                  â”‚
â”‚  âœ… Application functioning                                  â”‚
â”‚                                                              â”‚
â”‚  Progressing                                                 â”‚
â”‚  ğŸ”„ Rolling update in progress                               â”‚
â”‚  ğŸ”„ Pods starting                                            â”‚
â”‚  ğŸ”„ Wait for ready state                                     â”‚
â”‚                                                              â”‚
â”‚  Degraded                                                    â”‚
â”‚  âš ï¸  Some pods failing                                       â”‚
â”‚  âš ï¸  Resources not ready                                     â”‚
â”‚  âš ï¸  Investigate issues                                      â”‚
â”‚                                                              â”‚
â”‚  Missing                                                     â”‚
â”‚  âŒ Resources not found                                      â”‚
â”‚  âŒ Deployment failed                                        â”‚
â”‚  âŒ Check logs                                               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Quick Reference

### Check PVC Status

```bash
# View PVC
kubectl get pvc -n default

# Describe PVC (shows events and mount status)
kubectl describe pvc postgres-pvc -n default

# Check which pod is using it
kubectl get pods -n default -o=jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.spec.volumes[*].persistentVolumeClaim.claimName}{"\n"}{end}'

# Check storage usage
kubectl exec -n default deployment/postgres -- df -h /var/lib/postgresql/data
```

### Check ArgoCD Sync Status

```bash
# View all applications
kubectl get applications -n argocd

# Get detailed app status
kubectl get application node-demo-app -n argocd -o yaml

# View sync history
argocd app history node-demo-app

# Force manual sync
argocd app sync node-demo-app

# Hard refresh (re-fetch from Git)
argocd app get node-demo-app --hard-refresh
```

---

## Summary

### Key Concepts

**PVC (Persistent Volume Claim):**
- âœ… Provides persistent storage for stateful applications
- âœ… Data survives pod restarts/deletions
- âœ… ReadWriteOnce = Only one pod can mount at a time
- âœ… Essential for databases like PostgreSQL

**ArgoCD Sync:**
- âœ… Git is the single source of truth
- âœ… Automatic synchronization every 3 minutes
- âœ… Self-heal: Reverts manual cluster changes
- âœ… Auto-prune: Deletes resources removed from Git
- âœ… Zero-downtime deployments with rolling updates

**GitOps Principle:**
```
Desired State (Git) â†’ ArgoCD â†’ Actual State (Cluster)
                    â†‘          â†“
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   Continuous Sync
```

---

**Author:** DevOps Team  
**Last Updated:** October 2025  
**Version:** 1.0

